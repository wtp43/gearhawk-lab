machine:
  nodeLabels:
    topology.kubernetes.io/region: ${cluster_name}
    topology.kubernetes.io/zone: ${node_name}
    node.longhorn.io/create-default-disk: "config"
%{ if hostname == "work-00"}
  kernel:
    modules:
      - name: nvidia
      - name: nvidia_uvm
      - name: nvidia_drm
      - name: nvidia_modeset
  sysctls:
    net.core.bpf_jit_harden: 1
  nodeAnnotations:
    node.longhorn.io/default-disks-config: >
      [
        { "path":"/var/lib/longhorn", "allowScheduling":true }
      ]
%{ endif }
%{ if hostname != "work-00"}
  nodeAnnotations:
    node.longhorn.io/default-disks-config: >
      [
        { "path":"/var/lib/longhorn", "allowScheduling":true }
      ]
%{ endif }
  network:
    hostname: ${hostname}
    interfaces:
      - deviceSelector:
          hardwareAddr: ${mac_address}
        addresses:
          - ${ip}/${subnet_mask}
        routes:
          - network: 0.0.0.0/0
            gateway: ${gateway}
        dhcp: false
%{ if vip != null }
        vip:
          ip: ${vip}
%{ endif }
  kubelet:
    extraConfig:
      imageGCHighThresholdPercent: 60
      imageGCLowThresholdPercent: 50
    extraArgs:
      rotate-server-certificates: true
    extraMounts:
      - destination: /var/lib/longhorn
        type: bind
        source: /var/lib/longhorn
        options:
          - bind
          - rshared
          - rw

